var Dom=YAHOO.util.Dom;var Event=YAHOO.util.Event;var valid=false;var requestId;var isTeam;var active="";var activeTeamId=0;var titlePopup="";var teamPopup="";var isTeamPopup;var result;var popMenu=function(){Dom.setStyle("charts_menu","visibility","visible");Dom.setStyle("bar","visibility","hidden")};var hideMenu=function(){if(!valid){Dom.setStyle("charts_menu","visibility","hidden");Dom.setStyle("bar","visibility","visible")}};var fadeMenu=function(){setTimeout(hideMenu,500)};var showError=function(e){Dom.setStyle("errorPan","display","block");Dom.get("error_content").innerHTML=e};var showChartList=function(a){var b=Dom.getStyle("charts_"+a,"display");if(b=="none"){Dom.setStyle("charts_"+a,"display","block")}if(b=="block"){Dom.setStyle("charts_"+a,"display","none")}};var setChart=function(a,b,c){Dom.setStyle("charts_menu","visibility","hidden");Dom.setStyle("bar","visibility","visible");Dom.get("current").innerHTML="<span style='color:#3388DD'>Chart </span>"+b;requestId=a;isTeam=0;active=b;activeTeamId=c};var setTeam=function(a,b){Dom.setStyle("charts_menu","visibility","hidden");Dom.setStyle("bar","visibility","visible");Dom.get("current").innerHTML="<span style='color:#3388DD'>Team </span>"+b;requestId=a;isTeam=1;active=b;activeTeamId=a};var showOOC=function(){Dom.setStyle("errorPan","display","none");if(requestId==undefined){showError("您没有选择Chart(s)。");return}var a=Dom.get("minDate").innerHTML+" "+Dom.get("minTime").value;var b=Dom.get("maxDate").innerHTML+" "+Dom.get("maxTime").value;if(a==b){showError("您选择的时间没有间隔。");return}Dom.get("results").innerHTML="<img src='../img/loading_tiny.gif'/>";var c="id="+requestId+"&isTeam="+isTeam;c=c+"&minTime="+a;c=c+"&maxTime="+b;var d=function(o){result=o.responseText;Dom.get("results").innerHTML=result;Dom.get('eventBt').style.display="block";titlePopup=active;teamPopup=activeTeamId;isTeamPopup=isTeam};var e={success:d};var f=YAHOO.util.Connect.asyncRequest('POST','getOOCHistory.php',e,c)};var add=function(){var a=Dom.get("minDate").innerHTML+" "+Dom.get("minTime").value;var b=Dom.get("maxDate").innerHTML+" "+Dom.get("maxTime").value;var c="(Chart)";if(isTeamPopup)c="(Team)";var d=a+"~"+b+c+titlePopup+"的OOC状况";popUp(d,Dom.get("results").innerHTML,teamPopup);Dom.setStyle("bar","visibility","hidden")};var refreshCaller=function(a){Dom.setStyle("bar","visibility","visible")};Event.onDOMReady(function(){Event.addListener(["current","arrow"],"mouseover",popMenu);Event.addListener(["current","arrow"],"mouseout",fadeMenu);Event.addListener(["current","arrow"],"mousemove",popMenu);Event.addListener("charts_menu","mouseover",function(){valid=true});Event.addListener("charts_menu","mouseout",function(){valid=false;fadeMenu()});Event.addListener("showBt","click",showOOC);Event.addListener("eventBt","click",add)});var lastWeek=new Date();var tomorow=new Date();lastWeek.setDate(lastWeek.getDate()-6);tomorow.setDate(tomorow.getDate()+1);var minDateInit=lastWeek.getFullYear()+"/"+(lastWeek.getMonth()+1)+"/"+lastWeek.getDate();var maxDateInit=tomorow.getFullYear()+"/"+(tomorow.getMonth()+1)+"/"+tomorow.getDate();var minTimeInit=maxTimeInit="0:00";